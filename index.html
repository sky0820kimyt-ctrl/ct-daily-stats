<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CTì‹¤ ì¼ì¼ ê²€ì‚¬ í†µê³„ (ì¢…ì´ ì–‘ì‹)</title>
  <style>
    body{font-family:Arial,"Apple SD Gothic Neo","Malgun Gothic",sans-serif;margin:14px;color:#111}
    .controls{border:1px solid #ddd;border-radius:12px;padding:12px;margin-bottom:12px}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:end}
    input[type="file"]{display:none}
    input[type="text"], select, textarea{border:1px solid #ddd;border-radius:10px;padding:8px 10px}
    button{border:1px solid #ddd;border-radius:10px;padding:10px 12px;background:#fff;cursor:pointer}
    button:active{transform:translateY(1px)}
    .muted{color:#666;font-size:12px}
    .warn{color:#b00020;font-weight:800}
    .ok{color:#0a7a2f;font-weight:800}

    .drop{border:2px dashed #cfcfcf;border-radius:12px;padding:10px 12px;background:#fff;min-width:240px;user-select:none}
    .drop strong{display:block;font-size:13px;margin-bottom:4px}
    .drop .hint{font-size:12px;color:#666}
    .drop.dragover{border-color:#111;background:#fafafa}
    .drop .file{margin-top:6px;font-size:12px;color:#111}

    .paper{border:1px solid #000;padding:12px}
    .header{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:10px}
    .title{font-size:20px;font-weight:800;text-align:center;flex:1}
    .date{font-size:13px;font-weight:800}

    .layout{display:grid;grid-template-columns:62% 38%;gap:12px}
    .box{border:1px solid #000}
    .box-title{font-weight:800;padding:6px 8px;border-bottom:1px solid #000}
    .pad{padding:8px}

    table{width:100%;border-collapse:collapse;font-size:12px}
    th,td{border:1px solid #000;padding:4px 6px;text-align:center}
    th{background:#f5f5f5;font-weight:800}
    .left{text-align:left}
    .sum{background:#fafafa;font-weight:800}
    .section{background:#efefef;font-weight:800}

    .mini th,.mini td{padding:6px 6px;font-size:12px}

    .badge { display:inline-block; padding:2px 8px; border:1px solid #000; border-radius:999px; font-size:12px; margin-left:6px; }
    .badge.ok { border-color:#0a7a2f; color:#0a7a2f; }
    .badge.warn { border-color:#b00020; color:#b00020; }

    .unbox{border:1px solid #ddd;border-radius:12px;padding:10px;margin-top:10px;background:#fff}
    .unhead{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:8px}
    .unlist{max-height:220px;overflow:auto;border:1px solid #eee;border-radius:10px}
    .unitem{display:flex;justify-content:space-between;align-items:center;gap:8px;padding:8px 10px;border-bottom:1px solid #f1f1f1;cursor:pointer}
    .unitem:hover{background:#fafafa}
    .pill{font-size:11px;border:1px solid #ddd;border-radius:999px;padding:2px 8px;color:#333}
    .count{font-weight:800}
    .row2{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    .btnsm{padding:8px 10px;border-radius:10px}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size:11px}
    .export{white-space:pre-wrap;background:#fafafa;border:1px solid #eee;border-radius:10px;padding:10px;max-height:180px;overflow:auto}
    .hidden{display:none}

    .rulebox{border:1px solid #eee;border-radius:12px;padding:10px;margin-top:10px;background:#fff}
    .copybox{border:1px solid #ddd;border-radius:12px;padding:10px;margin-top:10px;background:#fff}
    textarea{width:100%;min-height:120px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size:12px}
    
    .panel{border:1px solid #eee;border-radius:12px;padding:10px;background:#fff;margin-top:10px}
    .panel-title{font-weight:800;margin-bottom:6px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}

    /* âœ… ê³µí†µ ê²½ê³  ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
    .dupbox{border:1px solid #ddd;border-radius:12px;padding:10px;margin-top:10px;background:#fff}
    .duphead{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:8px}
    .duplist{max-height:220px;overflow:auto;border:1px solid #eee;border-radius:10px}
    .dupitem{display:flex;justify-content:space-between;align-items:flex-start;gap:10px;padding:8px 10px;border-bottom:1px solid #f1f1f1}
    .dupitem .pid{font-weight:900}
    .dupitem .meta{font-size:12px;color:#555;margin-top:2px;white-space:pre-wrap}
    .dupitem .badge2{font-weight:900;color:#b00020;border:1px solid #b00020;border-radius:999px;padding:2px 8px;font-size:11px;white-space:nowrap}

    /* âœ… ë°© ì˜¤ë¥˜ ìƒì„¸ ê·¸ë¦¬ë“œ */
    .error-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap:10px; margin-top:10px; }
    .error-card { border:1px solid #b00020; border-radius:10px; padding:10px; background:#fff5f5; font-size:12px; }
    .error-card b { color:#b00020; }

    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;z-index:9999}
    .modal{background:#fff;border-radius:14px;max-width:720px;width:92vw;border:1px solid #ddd;box-shadow:0 12px 40px rgba(0,0,0,.18)}
    .modal-head{padding:12px 14px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center;gap:10px}
    .modal-body{padding:12px 14px}
    .modal-foot{padding:12px 14px;border-top:1px solid #eee;display:flex;gap:8px;justify-content:flex-end;flex-wrap:wrap}
    .chip{display:inline-flex;align-items:center;gap:6px;border:1px solid #ddd;border-radius:999px;padding:6px 10px;font-size:12px;cursor:pointer;background:#fff}

    @media print{
      .controls, .unbox, .copybox, .dupbox, .modal-backdrop, #mismatchBox{display:none !important}
      body{margin:0}
      .paper{border:none;padding:0}
    }
  </style>
</head>
<body>

<div class="controls">
  <div class="row">
    <div class="drop" id="drop-ledger">
      <strong>1) ê²€ì‚¬ëŒ€ì¥</strong>
      <div class="hint">R, ì‹œê°, ê²€ì‚¬ëª…, ì¡°ì˜ì œ, íšŸìˆ˜, ê²€ì‚¬ì1, I/O/E, ì§„ë£Œê³¼ ë“±</div>
      <div class="file" id="name-ledger">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</div>
      <input id="fLedger" type="file" accept=".xlsx,.xls" />
    </div>

    <div class="drop" id="drop-contrast">
      <strong>2) ì¡°ì˜ì œí†µê³„(ì„ íƒ)</strong>
      <div class="hint">ë¶ˆì¼ì¹˜ í™•ì¸ìš©(í‘œ í‘œì‹œëŠ” ì‹¤ì‚¬ìš© ê¸°ì¤€)</div>
      <div class="file" id="name-contrast">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</div>
      <input id="fContrast" type="file" accept=".xlsx,.xls" />
    </div>

    <div class="drop" id="drop-dept">
      <strong>3) ê²€ì‚¬ì‹œí–‰ë¶€ì„œ í†µê³„(ë¹„êµìš©)</strong>
      <div class="hint">ë¶€ìœ„ ì„¹ì…˜ì˜ â€œí•©ê³„â€ í–‰(1~5ë²ˆ/ê±´ìˆ˜)ì„ ì •ë‹µìœ¼ë¡œ ë¹„êµ</div>
      <div class="file" id="name-dept">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</div>
      <input id="fDept" type="file" accept=".xlsx,.xls" />
    </div>

    <div style="min-width:240px;">
      <div class="muted">ë‚ ì§œ(í‘œì‹œìš©)</div>
      <input id="reportDate" type="text" placeholder="ì˜ˆ: 2025ë…„ 12ì›” 21ì¼" />
    </div>

    <button id="run">ìƒì„±</button>
    <button id="printBtn">ì¸ì‡„ / PDF</button>
  </div>

  <div class="row2" style="margin-top:10px;">
    <input id="fCfg" type="file" accept=".json,application/json" style="display:none" />
    <button class="btnsm" id="btnDownloadCfg" type="button">ì„¤ì • ë°±ì—…(.json)</button>
    <button class="btnsm" id="btnUploadCfg" type="button">ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°(.json)</button>
    <button class="btnsm" id="btnCopyAllTSV" type="button">TSV 3ì¢… í•œë²ˆì— ë³µì‚¬</button>
  </div>

  <div id="status" class="muted" style="margin-top:8px;"></div>

  <div class="dupbox" id="mismatchBox" style="display:none; border: 2px solid #b00020;">
    <div class="duphead">
      <div>
        <div style="font-weight:900; color:#b00020; font-size:15px;">ğŸš© ë°© ë²ˆí˜¸ ì´ˆê³¼ ì…ë ¥ ì˜ì‹¬ í™˜ì ëª…ë‹¨ (ëŒ€ì¡°ìš©)</div>
        <div class="muted">3ë²ˆ í†µê³„í‘œ ìˆ«ìë³´ë‹¤ ëŒ€ì¥ì— ë” ë§ì´ ì…ë ¥ëœ ë°©ì˜ í™˜ì ëª…ë‹¨ì…ë‹ˆë‹¤.</div>
      </div>
    </div>
    <div class="error-grid" id="mismatchList"></div>
  </div>

  <div class="dupbox" id="dupBox" style="display:none;">
    <div class="duphead">
      <div>
        <div style="font-weight:900;">âš ï¸ ê°™ì€ í™˜ì ì¡°ì˜ì œ ì¤‘ë³µ ê²½ê³ </div>
        <div class="muted">ë“±ë¡ë²ˆí˜¸ ê¸°ì¤€ ì •ë ¬ Â· ì¡°ì˜ì œ ì…ë ¥ê²€ì‚¬ 2ê±´ ì´ìƒ ë˜ëŠ” ì¡°ì˜ì œ ì¢…ë¥˜ 2ì¢… ì´ìƒ</div>
      </div>
      <button class="btnsm" id="btnCopyDup" type="button">ëª©ë¡ ë³µì‚¬</button>
    </div>
    <div class="duplist" id="dupList"></div>
    <textarea id="dupCopy" class="hidden"></textarea>
  </div>

  <div class="panel">
    <div class="panel-title">ì•¼ê°„ê·¼ë¬´ì í”„ë¦¬ì…‹</div>
    <div class="grid2">
      <input id="team1" type="text" placeholder="ì¡°1 (ì½¤ë§ˆë¡œ êµ¬ë¶„)" style="width:100%" />
      <input id="team2" type="text" placeholder="ì¡°2 (ì½¤ë§ˆë¡œ êµ¬ë¶„)" style="width:100%" />
    </div>
    <div class="row2" style="margin-top:6px;">
      <button class="btnsm" id="btnApplyTeam1" type="button">ì¡°1 ì ìš©</button>
      <button class="btnsm" id="btnApplyTeam2" type="button">ì¡°2 ì ìš©</button>
      <input id="nightNames" type="text" placeholder="ì‹¤ì œ ì•¼ê°„ ê·¼ë¬´ì" style="flex:1" />
    </div>
  </div>

  <div class="panel">
    <div id="catChips" class="row2"></div>
    <div id="examCatRulesView" class="muted" style="margin-top:8px;"></div>
  </div>

  <div class="unbox">
    <div class="unhead"><strong>ë¯¸ë¶„ë¥˜ ê²€ì‚¬ ìë™ ëª©ë¡</strong></div>
    <div class="unlist" id="unlist"></div>
    <div id="ruleEditor" class="hidden" style="margin-top:10px; border-top:1px solid #eee; padding-top:10px;">
      <div id="selExamText" style="font-weight:800; margin-bottom:10px;"></div>
      <div class="row2">
        <select id="ruleMode"><option value="contains">ë¶€ë¶„ í¬í•¨</option><option value="exact">ì •í™•íˆ ì¼ì¹˜</option></select>
        <input id="ruleKeyword" type="text" style="flex:1" />
        <select id="ruleCategory"></select>
        <button id="btnAddRule">ì €ì¥</button>
      </div>
    </div>
    <div id="rulesView" class="muted" style="margin-top:10px;"></div>
  </div>

  <div class="copybox">
    <div class="muted">ì›ë³¸ ë³µì‚¬ìš© TSV ë°ì´í„° (ìˆ«ìë§Œ)</div>
    <textarea id="tsvExam" style="height:60px;"></textarea>
    <textarea id="tsvContrast" style="height:60px; margin-top:5px;"></textarea>
    <textarea id="tsvShift" style="height:60px; margin-top:5px;"></textarea>
  </div>
</div>

<div class="paper">
  <div class="header">
    <div style="width:120px;"></div>
    <div class="title">CTì‹¤ ì¼ì¼ ê²€ì‚¬ í†µê³„ <span id="matchBadge" class="badge" style="display:none;"></span></div>
    <div class="date" id="dateText"></div>
  </div>

  <div class="layout">
    <div class="box">
      <div class="box-title">ê²€ì‚¬ì‹¤ë¶„ë¥˜</div>
      <div class="pad">
        <table>
          <thead><tr><th class="left">ê²€ì‚¬ëª…</th><th>ê³„</th><th>CT1</th><th>CT2</th><th>CT3</th><th>CT4</th><th>CT5</th></tr></thead>
          <tbody id="examBody"></tbody>
          <tfoot><tr class="sum"><td class="left">í•©ê³„</td><td id="exam_total">0</td><td id="exam_1">0</td><td id="exam_2">0</td><td id="exam_3">0</td><td id="exam_4">0</td><td id="exam_5">0</td></tr></tfoot>
        </table>
      </div>
    </div>
    <div style="display:flex;flex-direction:column;gap:12px;">
      <div class="box">
        <div class="box-title">2. ì§„ë£Œì¬ë£Œ í™•ì¸ (ì¡°ì˜ì œ) <span class="badge" id="usageBadge" style="display:none;"></span></div>
        <div class="pad"><table><tbody id="contrastBody"></tbody></table></div>
      </div>
      <div class="box">
        <div class="box-title">ê²€ì‚¬ì‹¤ êµ¬ë¶„</div>
        <div class="pad">
          <table class="mini">
            <tbody id="shiftBody">
              <tr><td class="left">ì£¼ê°„</td><td id="day_total">0</td><td id="day_1">0</td><td id="day_2">0</td><td id="day_3">0</td><td id="day_4">0</td><td id="day_5">0</td></tr>
              <tr><td class="left">ì•¼ê°„</td><td id="night_total">0</td><td id="night_1">0</td><td id="night_2">0</td><td id="night_3">0</td><td id="night_4">0</td><td id="night_5">0</td></tr>
              <tr class="sum"><td class="left">ì „ì²´ ê³„</td><td id="all_total">0</td><td id="all_1">0</td><td id="all_2">0</td><td id="all_3">0</td><td id="all_4">0</td><td id="all_5">0</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal-backdrop" id="catModalBackdrop">
  <div class="modal">
    <div class="modal-head"><div class="modal-title" id="catModalTitle">í¸ì§‘</div><button id="btnCloseCatModal">ë‹«ê¸°</button></div>
    <div class="modal-body"><textarea id="catModalTextarea" style="min-height:200px"></textarea></div>
    <div class="modal-foot"><button id="btnSaveCatModal">ì €ì¥</button></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
  const $ = (id)=>document.getElementById(id);
  const norm = (v)=>(v==null)?"":String(v).trim();
  const toNum = (v)=> { const n=Number(String(v??"").replace(/,/g,"")); return Number.isFinite(n)?n:0; };

  const LEDGER = { room:"R", time:"ì‹œê°", exam:"ê²€ì‚¬ëª…", contrast:"ì¡°ì˜ì œ", cnt:"íšŸìˆ˜", tech:"ê²€ì‚¬ì1", ioe:"I/O/E", dept:"ì§„ë£Œê³¼", pid:"ë“±ë¡ë²ˆí˜¸" };
  const DEPT = { area:"ë¶€ìœ„", n1:"1ë²ˆ", n2:"2ë²ˆ", n3:"3ë²ˆ", n4:"4ë²ˆ", n5:"5ë²ˆ", total:"ê±´ìˆ˜" };

  const EXAM_TEMPLATE = [
    { type:"item", label:"Head" }, { type:"item", label:"Neck" }, { type:"item", label:"Spine" }, { type:"item", label:"Thorax" },
    { type:"item", label:"Abdomen" }, { type:"item", label:"Pelvis" }, { type:"item", label:"Extremity" }, { type:"item", label:"Dynamic" },
    { type:"item", label:"Abd+Pelv" }, { type:"item", label:"Myelography" }, { type:"item", label:"DVT" }, { type:"group", label:"Angio" },
    { type:"item", label:"Head/Neck", indent:1, key:"Angio Head/Neck" }, { type:"item", label:"Abdomen", indent:1, key:"Angio Abdomen" },
    { type:"item", label:"Pulmo-", indent:1, key:"Angio Pulmo-" }, { type:"item", label:"Dissec", indent:1, key:"Angio Dissec" },
    { type:"item", label:"Heart", indent:1, key:"Angio Heart" }, { type:"item", label:"Extremity", indent:1, key:"Angio Extremity" },
    { type:"group", label:"3D Volume" }, { type:"item", label:"Head", indent:1, key:"3D Head" }, { type:"item", label:"Abdomen", indent:1, key:"3D Abdomen" },
    { type:"item", label:"Chest", indent:1, key:"3D Chest" }, { type:"item", label:"Spine", indent:1, key:"3D Spine" }, { type:"item", label:"Extremity", indent:1, key:"3D Extremity" },
    { type:"sum", label:"í•©ê³„" }
  ];

  const RULES_KEY = "ct_stat_user_rules_v2";
  const EXAMCAT_KEY = "ct_stat_examcat_rules_v1";

  function loadJSON(key, fallback){ try{ const raw=localStorage.getItem(key); return raw?JSON.parse(raw):fallback; }catch(e){return fallback;} }
  function saveJSON(key, val){ localStorage.setItem(key, JSON.stringify(val)); }
  function extractRoomNo(v){ 
    const s=String(v??"").trim(); if(!s)return null; 
    const m=s.match(/\d+/); if(!m)return null; 
    const r=m[0]; if(r==="31")return 5; if(r==="41")return 4;
    const n=Number(r); return (n>=1 && n<=5)?n:null;
  }

  async function readFirstSheet(file){
    const buf = await file.arrayBuffer();
    const wb = XLSX.read(buf,{type:"array"});
    return XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]],{defval:""});
  }

  // âœ… ë©”ì¸ ì‹¤í–‰ ë¡œì§
  $("run").addEventListener("click", async ()=>{
    const fLedger = $("fLedger").files[0];
    const fDept = $("fDept").files[0];
    if(!fLedger) return alert("ê²€ì‚¬ëŒ€ì¥ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.");

    $("status").textContent = "ë¶„ì„ ì¤‘...";
    const ledgerRows = await readFirstSheet(fLedger);
    const userRules = loadJSON(RULES_KEY, []);
    const examCatRules = loadJSON(EXAMCAT_KEY, {});
    const nightSet = new Set($("nightNames").value.split(",").map(s=>s.trim()).filter(Boolean));

    // ë°ì´í„° ì €ì¥ì†Œ
    const examAgg = new Map();
    EXAM_TEMPLATE.forEach(t => { if(t.type==="item") examAgg.set(t.key||t.label, {total:0, by:{1:0,2:0,3:0,4:0,5:0}}); });
    const dayAgg = {total:0, by:{1:0,2:0,3:0,4:0,5:0}};
    const nightAgg = {total:0, by:{1:0,2:0,3:0,4:0,5:0}};
    const ledgerDetailMap = {}; // ì˜¤ì…ë ¥ ì¶”ì ìš© ëª…ë‹¨

    ledgerRows.forEach(row => {
      const room = extractRoomNo(row[LEDGER.room]);
      if(!room) return;
      const pid = norm(row[LEDGER.pid]);
      const rawExam = norm(row[LEDGER.exam]);
      const tech = norm(row[LEDGER.tech]);
      const cnt = toNum(row[LEDGER.cnt]) || 1;

      // ë¶€ìœ„ ë¶„ë¥˜ (ë‹¨ìˆœí™”ëœ ì˜ˆì‹œ ë¡œì§)
      let cat = "Head"; 
      if(rawExam.toUpperCase().includes("ABD")) cat = "Abdomen";
      if(rawExam.toUpperCase().includes("CHEST")) cat = "Thorax";
      // ... ì‹¤ì œ ë¶„ë¥˜ ë¡œì§ í•„ìš”

      // ëª…ë‹¨ ìˆ˜ì§‘ (ì˜¤ë¥˜ ì¶”ì ìš©)
      if(!ledgerDetailMap[cat]) ledgerDetailMap[cat] = {1:[], 2:[], 3:[], 4:[], 5:[]};
      ledgerDetailMap[cat][room].push({ pid, exam: rawExam.substring(0,20), time: norm(row[LEDGER.time]) });

      // í†µê³„ ê°€ì‚°
      const target = examAgg.get(cat);
      if(target) { target.total += cnt; target.by[room] += cnt; }
      
      const shift = (nightSet.has(tech)) ? nightAgg : dayAgg;
      shift.total += cnt; shift.by[room] += cnt;
    });

    // í™”ë©´ ë Œë”ë§ (í…Œì´ë¸” ë“± ìƒëµ - ê¸°ì¡´ ë¡œì§ ìœ ì§€)
    // ... (examBody, shiftBody ì±„ìš°ëŠ” ì½”ë“œ)

    // âœ… ë°© ì˜¤ë¥˜/ì¶”ê°€ì…ë ¥ ì¶”ì¶œ ë¡œì§
    if(fDept) {
      const deptRows = await readFirstSheet(fDept);
      const mismatches = [];
      deptRows.forEach(r => {
        const area = norm(r[DEPT.area]);
        if(!area || area === "í•©ê³„" || area.includes("ì¡°ì˜ì œ")) return;

        for(let i=1; i<=5; i++) {
          const deptCount = toNum(r[i+"ë²ˆ"]);
          const ledgerList = (ledgerDetailMap[area] && ledgerDetailMap[area][i]) ? ledgerDetailMap[area][i] : [];
          
          // ëŒ€ì¥ì´ í†µê³„ë³´ë‹¤ ë§ì€ ê²½ìš° (ì´ˆê³¼ ì…ë ¥)
          if(ledgerList.length > deptCount) {
            mismatches.push({ area, room: i, ledgerCount: ledgerList.length, deptCount, patients: ledgerList });
          }
        }
      });

      const mBox = $("mismatchBox");
      const mList = $("mismatchList");
      if(mismatches.length > 0) {
        mBox.style.display = "block";
        mList.innerHTML = mismatches.map(m => `
          <div class="error-card">
            <div style="font-weight:900; border-bottom:1px solid #b00020; margin-bottom:5px;">
              ${m.area} (CT ${m.room}ë²ˆë°©) <br> 
              ëŒ€ì¥ <b>${m.ledgerCount}</b> > í†µê³„ <b>${m.deptCount}</b>
            </div>
            ${m.patients.map((p, idx)=> `<div>${idx+1}. ${p.pid} (${p.time})</div>`).join("")}
          </div>
        `).join("");
      } else {
        mBox.style.display = "none";
      }
    }
    
    $("status").textContent = "ìƒì„± ì™„ë£Œ âœ…";
  });

  // ê¸°íƒ€ ì´ˆê¸°í™” ë¡œì§ (ì¹´í…Œê³ ë¦¬ ì¹© ë“± ê¸°ì¡´ ì½”ë“œ ìœ ì§€)
  function renderCatChips(){
    const box = $("catChips");
    box.innerHTML = "";
    allCategoryKeys().forEach(cat => {
      const chip = document.createElement("div");
      chip.className = "chip";
      chip.innerHTML = `<b>${cat}</b>`;
      chip.onclick = () => openCatModal(cat);
      box.appendChild(chip);
    });
  }
  function allCategoryKeys(){ return EXAM_TEMPLATE.filter(x => x.type === "item").map(x => x.key || x.label); }
  renderCatChips();
</script>
</body>
</html>
